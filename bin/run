#!/bin/bash
set -eu
set -o pipefail

if [ -z "$KINKO_ROOT" ]; then
  KINKO_ROOT=$(realpath $(dirname $0)/../../..)
fi

SSL_CERT=$KINKO_ROOT/var/public/connectivity/shared/openssl.cert
SSL_KEY=$KINKO_ROOT/var/public/connectivity/shared/openssl.priv

ssmtpd=$(dirname $BASH_SOURCE)/ssmtpd
exec $ssmtpd                                            \
        --auth          $BASH_SOURCE.auth               \
        --hostname      `kinko name`                    \
        --port 8025                                     \
        --ssl-key       $SSL_KEY                        \
        --ssl-cert      $SSL_CERT                       \
        --accounts-db   var/accounts.sqlite3            \
        --filter        kinko.mailqueue.forward
